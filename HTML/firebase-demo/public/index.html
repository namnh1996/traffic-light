<!DOCTYPE html>
<html>
    <head>
        <Title>Todo-List</Title>
    </head>
    <body>
        <input type="text" id="new-input">
        <button id="add-btn">Add</button>

        <div>
            <ul id="todo-list">

            </ul>
        </div>
        <script type="text/javascript">
            let storageKey = 'todoList';
            let dataString = localStorage.getItem(storageKey);
            let todoList;
            if(dataString){
                todoList = JSON.parse(dataString);
            } else{
                todoList = [];
            }
            let htmlList = document.getElementById('todo-list');
            let addBtn = document.getElementById('add-btn');
            let input = document.getElementById('new-input');
            input.value = sessionStorage.getItem('draft');
            //addBtn.onclick = addItem;
            addBtn.addEventListener('click', addItem);
            input.addEventListener('change', updateSessionStorage);
            htmlList.addEventListener('click', onListClicked);

            function onListClicked(event){
                let button = event.target;
                let index = parseInt(button.dataset.id);
                console.log(index);
                todoList.splice(index, 1);
                localStorage.setItem(storageKey, JSON.stringify(todoList));
                render();
            }

            function updateSessionStorage(){
                sessionStorage.setItem('draft', input.value);
            }


            function addItem(){
                let newItem = input.value;
                console.log(newItem);
                todoList.push(newItem);
                input.value = '';
                let reDraft = '';
                sessionStorage.setItem('draft', reDraft);
                render();
                //console.log(todoList);
                localStorage.setItem(storageKey, JSON.stringify(todoList));  
            };
            function render(){
                let content = todoList.map((item, index) => {
                return '<li>' + item + ' <button data-id="'+ index +'">Delete</button></li>';
                });
                let newContent = content.join('');
                htmlList.innerHTML = newContent;
            }
            render();
            
        </script>
    </body>
</html>